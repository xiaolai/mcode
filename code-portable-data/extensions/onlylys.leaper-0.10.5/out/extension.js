var J=Object.create;var b=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var H=n=>b(n,"__esModule",{value:!0});var T=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Z=(n,e)=>{H(n);for(var t in e)b(n,t,{get:e[t],enumerable:!0})},ee=(n,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of G(e))!Y.call(n,r)&&r!=="default"&&b(n,r,{get:()=>e[r],enumerable:!(t=X(e,r))||t.enumerable});return n},y=n=>ee(H(b(n!=null?J(Q(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var S=T(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.splitName=p.VCReader=void 0;var re=require("vscode"),N=class{constructor(e){if(this.args=e,e.name.trim().length===0)throw new Error("Name cannot be empty!");let{section:t,child:r}=W(e.name);this.section=t,this.child=r}get name(){return this.args.name}read(e){let t,r=this.inspect(e),i=this.args.transform;if(r.workspaceFolderLanguageValue!==void 0)t=i(r.workspaceFolderLanguageValue);else if(r.workspaceLanguageValue!==void 0)t=i(r.workspaceLanguageValue);else if(r.globalLanguageValue!==void 0)t=i(r.globalLanguageValue);else if(r.defaultLanguageValue!==void 0)t=i(r.defaultLanguageValue);else if(r.workspaceFolderValue!==void 0)t=i(r.workspaceFolderValue);else if(r.workspaceValue!==void 0)t=i(r.workspaceValue);else if(r.globalValue!==void 0)t=i(r.globalValue);else if(r.defaultValue!==void 0)t=i(r.defaultValue);else throw new Error(`No effective value for ${this.name}.`);return t}inspect(e){let t=re.workspace.getConfiguration(this.section,e).inspect(this.child);if(!t)throw new Error(`Unexpected error: Inspecting ${this.name} yields 'undefined'.`);let r=i=>this.args.validate(i)?i:void 0;return{defaultValue:r(t.defaultValue),globalValue:r(t.globalValue),workspaceValue:r(t.workspaceValue),workspaceFolderValue:r(t.workspaceFolderValue),defaultLanguageValue:r(t.defaultLanguageValue),globalLanguageValue:r(t.globalLanguageValue),workspaceLanguageValue:r(t.workspaceLanguageValue),workspaceFolderLanguageValue:r(t.workspaceFolderLanguageValue)}}};p.VCReader=N;function W(n){let e=n.lastIndexOf(".");return{section:n.slice(0,e),child:n.slice(e+1)}}p.splitName=W});var B=T(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});E.VCDualReader=void 0;var z=S(),j=class{constructor(e){this.args=e,this.newReader=new z.VCReader(e),this.deprReader=new z.VCReader({name:e.deprName,validate:e.deprValidate,transform:e.deprTransform})}get name(){return this.args.name}get deprName(){return this.args.deprName}read(e){let t=this.newReader.inspect(e),r=this.deprReader.inspect(e),i=this.args.transform,a=this.args.deprTransform,o;if(t.workspaceFolderLanguageValue!==void 0)o=i(t.workspaceFolderLanguageValue);else if(r.workspaceFolderLanguageValue!==void 0)o=a(r.workspaceFolderLanguageValue);else if(t.workspaceLanguageValue!==void 0)o=i(t.workspaceLanguageValue);else if(r.workspaceLanguageValue!==void 0)o=a(r.workspaceLanguageValue);else if(t.globalLanguageValue!==void 0)o=i(t.globalLanguageValue);else if(r.globalLanguageValue!==void 0)o=a(r.globalLanguageValue);else if(t.defaultLanguageValue!==void 0)o=i(t.defaultLanguageValue);else if(r.defaultLanguageValue!==void 0)o=a(r.defaultLanguageValue);else if(t.workspaceFolderValue!==void 0)o=i(t.workspaceFolderValue);else if(r.workspaceFolderValue!==void 0)o=a(r.workspaceFolderValue);else if(t.workspaceValue!==void 0)o=i(t.workspaceValue);else if(r.workspaceValue!==void 0)o=a(r.workspaceValue);else if(t.globalValue!==void 0)o=i(t.globalValue);else if(r.globalValue!==void 0)o=a(r.globalValue);else if(t.defaultValue!==void 0)o=i(t.defaultValue);else if(r.defaultValue!==void 0)o=a(r.defaultValue);else throw new Error(`No effective value between ${this.args.name} and ${this.args.deprName}.`);return o}inspect(e){return this.newReader.inspect(e)}deprInspect(e){return this.deprReader.inspect(e)}};E.VCDualReader=j});var q=T(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.VCDualReader=g.VCReader=void 0;var ne=S();Object.defineProperty(g,"VCReader",{enumerable:!0,get:function(){return ne.VCReader}});var ie=B();Object.defineProperty(g,"VCDualReader",{enumerable:!0,get:function(){return ie.VCDualReader}})});Z(exports,{activate:()=>ae,deactivate:()=>oe,testHandle:()=>K});var d=y(require("vscode"));var R=y(require("vscode")),L=class{constructor(e,t){this.name=e;R.commands.executeCommand("setContext",this.name,t),this._mostRecent=t}get mostRecent(){return this._mostRecent}set(e){e!==this._mostRecent&&(R.commands.executeCommand("setContext",this.name,e),this._mostRecent=e)}};var l=y(require("vscode"));var P=class{constructor(e){this.callback=e;this.timer=void 0}set(){this.timer||(this.timer=setImmediate(()=>{this.callback(),this.timer=void 0}))}clear(){this.timer&&(clearImmediate(this.timer),this.timer=void 0)}};var D=class{constructor(e){this._vertCarry=0;this._horzCarry={affectsLine:-1,value:0};this.src=e,this.top=e.length}get vertCarry(){return this._vertCarry}get horzCarry(){return this._horzCarry}pop(){if(this.top===0)return;let e=this.src[this.top-1].range,t=e.end.line-e.start.line+1,r=e.end.character-(t===1?e.start.character:0),i=this.src[this.top-1].text,{lines:a,lastLineLen:o}=te(i);this._vertCarry+=a-t;let s=o-r;t===1&&a>1?s-=e.start.character:t>1&&a===1&&(s+=e.start.character),a===1&&e.start.line===this._horzCarry.affectsLine&&(s+=this._horzCarry.value),this._horzCarry={affectsLine:e.end.line,value:s},this.top-=1}peek(){return this.top>0?this.src[this.top-1]:void 0}};function te(n){let e=1,t=0;for(let r=0;r<n.length;++r)n[r]===`
`?(++e,t=0):++t;return{lines:e,lastLineLen:t}}var x=class{constructor(e,t){this.owner=e;this.pairCount=0;this.onDidUpdateHasPairsEventEmitter=new l.EventEmitter;this._hasLineOfSight={stale:!0,value:!1};this.onDidUpdateHasLineOfSightEventEmitter=new l.EventEmitter;this.decorationsFixer=new P(()=>{for(let e of this.clusters)if(this._decorateAll)for(let t of e)t.decoration||(t.decoration=F(this.owner,t,this._decorationOptions));else{for(let t=0;t<e.length-1;++t)e[t].decoration?.dispose(),e[t].decoration=void 0;if(e.length>0){let t=e[e.length-1];t.decoration||(t.decoration=F(this.owner,t,this._decorationOptions))}}});this._decorateAll=t.decorateAll,this._decorationOptions=t.decorationOptions,this._detectedPairs=t.detectedPairs,this.sortedCursors=U(this.owner.selections),this.clusters=Array(this.sortedCursors.length).fill([])}get hasPairs(){return this.pairCount>0}get onDidUpdateHasPairs(){return this.onDidUpdateHasPairsEventEmitter.event}get hasLineOfSight(){if(this._hasLineOfSight.stale){let e=this.hasPairs&&this.sortedCursors.every(({cursor:t})=>t.isEmpty)&&this.clusters.some((t,r)=>{if(t.length>0){let i=this.sortedCursors[r].cursor,a=t[t.length-1],o=new l.Range(i.anchor,a.close);return!this.owner.document.getText(o).trim()}else return!1});this._hasLineOfSight={stale:!1,value:e}}return this._hasLineOfSight.value}get onDidUpdateHasLineOfSight(){return this.onDidUpdateHasLineOfSightEventEmitter.event}set decorateAll(e){this._decorateAll=e,this.decorationsFixer.set()}set decorationOptions(e){this._decorationOptions=e,this.clusters.forEach(t=>t.forEach(r=>{r.decoration?.dispose(),r.decoration=void 0})),this.decorationsFixer.set()}set detectedPairs(e){this._detectedPairs=e}notifySelectionChanges(e){let t=this.sortedCursors,r=this.hasPairs;if(this.sortedCursors=U(e),this.sortedCursors.length!==t.length){let i=this.clusters;this.clusters=[];let a=0;for(let{cursor:o}of this.sortedCursors){for(;a<t.length&&t[a].cursor.anchor.isBefore(o.anchor);)this.pairCount-=i[a].length,i[a++].forEach(s=>s.decoration?.dispose());a<t.length&&t[a].cursor.anchor.isEqual(o.anchor)?this.clusters.push(i[a++]):this.clusters.push([])}for(;a<t.length;)this.pairCount-=i[a].length,i[a++].forEach(o=>o.decoration?.dispose())}for(let[i,a]of this.clusters.entries()){let o=this.sortedCursors[i].cursor.anchor,s=!1;for(let h=a.length-1;h>=0&&(o.isBeforeOrEqual(a[h].open)||o.isAfter(a[h].close));--h)this.pairCount-=1,a.pop()?.decoration?.dispose(),s=!0;s&&a.length>0&&this.decorationsFixer.set()}this.hasPairs!==r&&this.onDidUpdateHasPairsEventEmitter.fire(void 0),r&&(this._hasLineOfSight.stale=!0,this.onDidUpdateHasLineOfSightEventEmitter.fire(void 0))}notifyContentChanges(e){let t=this.hasPairs,r=!1,i=new D(e);this.clusters=this.clusters.map((a,o)=>{let s=a;for(let c=0;c<s.length;++c){let u=s[c],f=M(i,u.open);f?u.open=f:(this.pairCount-=1,u.decoration?.dispose(),s[c]=void 0)}let h,w=this.sortedCursors[o].cursor;for(;i.peek()?.range.start.isBefore(w.anchor);)i.pop();if(i.peek()?.text.length===2&&i.peek()?.range.start.isEqual(w.anchor)&&i.peek()?.range.isEmpty&&w.isEmpty&&this._detectedPairs.includes(i.peek()?.text??"")){let c=w.anchor.translate(i.vertCarry,w.anchor.line===i.horzCarry.affectsLine?i.horzCarry.value:0);h={open:c,close:c.translate(0,1),decoration:void 0}}for(let c=s.length-1;c>=0;--c){let u=s[c];if(u){let f=M(i,u.close);f&&f.line===u.open.line?u.close=f:(this.pairCount-=1,u.decoration?.dispose(),s[c]=void 0)}}let A=s.filter(c=>!!c);return s.length>0&&!s[s.length-1]&&this.decorationsFixer.set(),h&&(r=!0,this.pairCount+=1,A.push(h),this.decorationsFixer.set()),A}),this.hasPairs!==t&&this.onDidUpdateHasPairsEventEmitter.fire(void 0),(t||r)&&(this._hasLineOfSight.stale=!0,this.onDidUpdateHasLineOfSightEventEmitter.fire(void 0))}leap(){if(!this.hasLineOfSight)return;let e=Array(this.sortedCursors.length).fill(void 0);for(let[t,{cursor:r,originalIndex:i}]of this.sortedCursors.entries()){let a=this.clusters[t];if(a.length>0){let s=a[a.length-1].close.translate(0,1);e[i]=new l.Selection(s,s)}else e[i]=r}this.owner.selections=e,this.owner.selections.length===1&&this.owner.revealRange(this.owner.selection)}clear(){this.clusters.forEach(e=>e.forEach(t=>t.decoration?.dispose())),this.clusters.fill([]),this.pairCount=0,this._hasLineOfSight.stale=!0,this.onDidUpdateHasPairsEventEmitter.fire(void 0),this.onDidUpdateHasLineOfSightEventEmitter.fire(void 0),this.decorationsFixer.clear()}dispose(){this.clear(),this.onDidUpdateHasPairsEventEmitter.dispose(),this.onDidUpdateHasLineOfSightEventEmitter.dispose()}snapshot(){let e=Array(this.clusters.length).fill(void 0);for(let[t,r]of this.clusters.entries()){let i=this.sortedCursors[t].originalIndex;e[i]=r.map(a=>{let o=[a.open.line,a.open.character],s=[a.close.line,a.close.character];return{open:o,close:s,isDecorated:!!a.decoration}})}return I(this._decorationOptions),{pairs:e,decorationOptions:this._decorationOptions}}};function U(n){return n.map((e,t)=>({cursor:e,originalIndex:t})).sort((e,t)=>e.cursor.anchor.compareTo(t.cursor.anchor))}function F(n,e,t){let r=l.window.createTextEditorDecorationType(t.cast());return n.setDecorations(r,[new l.Range(e.close,e.close.translate(0,1))]),r}function M(n,e){for(;n.peek()?.range.end.isBeforeOrEqual(e);)n.pop();if(!n.peek()?.range.start.isBeforeOrEqual(e))return e.translate(n.vertCarry,e.line===n.horzCarry.affectsLine?n.horzCarry.value:0)}function I(n){n==="object"&&n!==null&&(Reflect.ownKeys(n).forEach(e=>I(Reflect.get(n,e))),Object.freeze(n))}var k=y(require("vscode")),O=y(q());var V=class{constructor(e){this.v=e}cast(){return this.v}};var m=new O.VCDualReader({name:"leaper.decorateAll",validate:n=>typeof n=="boolean",transform:n=>n,deprName:"leaper.decorateOnlyNearestPair",deprValidate:n=>typeof n=="boolean",deprTransform:n=>!n}),v=new O.VCDualReader({name:"leaper.decorationOptions",validate:n=>typeof n=="object"&&(n===null||!Reflect.has(n,"rangeBehavior")),transform:n=>{n===null&&(n={});function e(r){for(let i of Reflect.ownKeys(r)){let a=Reflect.get(r,i);typeof a=="object"&&a!==null?e(a):typeof i=="string"&&/[cC]olor$/.test(i)&&typeof a=="string"&&(a.length===0||a[0]!=="#")&&Reflect.set(r,i,new k.ThemeColor(a))}}e(n);let t=new V(n);return t.cast().rangeBehavior=k.DecorationRangeBehavior.ClosedClosed,t},deprName:"leaper.customDecorationOptions",deprValidate:n=>typeof n=="object"&&n!==null,deprTransform:n=>{let e=new V(n);return e.cast().rangeBehavior=k.DecorationRangeBehavior.ClosedClosed,e}}),C=new O.VCDualReader({name:"leaper.detectedPairs",validate:n=>Array.isArray(n)&&n.length<=$&&n.every(e=>typeof e=="string"&&e.length===2)&&n.length===new Set(n).size,transform:n=>n,deprName:"leaper.additionalTriggerPairs",deprValidate:n=>{function e(t){return typeof t=="object"&&t!==null&&Reflect.ownKeys(t).length===2&&Reflect.has(t,"open")&&Reflect.has(t,"close")&&typeof t.open=="string"&&typeof t.close=="string"&&t.open.length===1&&t.close.length===1}return Array.isArray(n)&&n.length<=$&&n.every(e)},deprTransform:n=>["()","[]","{}","<>","``","''",'""'].concat(n.map(({open:t,close:r})=>`${t}${r}`))}),$=100;var _=class{constructor(){this.leapCommand=d.commands.registerTextEditorCommand("leaper.leap",e=>this.trackers.get(e)?.leap());this.escapeLeaperModeCommand=d.commands.registerTextEditorCommand("leaper.escapeLeaperMode",e=>this.trackers.get(e)?.clear());this.inLeaperModeContext=new L("leaper.inLeaperMode",!1);this.hasLineOfSightContext=new L("leaper.hasLineOfSight",!1);this.activeTextEditorChangeWatcher=d.window.onDidChangeActiveTextEditor(()=>this.resyncContexts());this.visibleTextEditorsChangeWatcher=d.window.onDidChangeVisibleTextEditors(e=>{let t=new Map;for(let r of e){let i=this.trackers.get(r);if(i)t.set(r,i);else{let a=r.document;t.set(r,new x(r,{decorateAll:m.read(a),decorationOptions:v.read(a),detectedPairs:C.read(a)}))}}for(let[r,i]of this.trackers.entries())t.has(r)||i.dispose();this.trackers=t});this.selectionChangeWatcher=d.window.onDidChangeTextEditorSelection(e=>{this.trackers.get(e.textEditor)?.notifySelectionChanges(e.selections)});this.contentChangeWatcher=d.workspace.onDidChangeTextDocument(e=>{for(let[t,r]of this.trackers)e.document===t.document&&r.notifyContentChanges(e.contentChanges)});this.configurationChangeWatcher=d.workspace.onDidChangeConfiguration(e=>{for(let[t,r]of this.trackers){let i=t.document;!e.affectsConfiguration("leaper",i)||((e.affectsConfiguration(m.name,i)||e.affectsConfiguration(m.deprName,i))&&(r.decorateAll=m.read(i)),(e.affectsConfiguration(v.name,i)||e.affectsConfiguration(v.deprName,i))&&(r.decorationOptions=v.read(i)),(e.affectsConfiguration(C.name,i)||e.affectsConfiguration(C.deprName,i))&&(r.detectedPairs=C.read(i)))}});this.trackers=new Map(d.window.visibleTextEditors.map(e=>{let t=e.document;return[e,new x(e,{decorateAll:m.read(t),decorationOptions:v.read(t),detectedPairs:C.read(t)})]})),this.resyncContexts()}resyncContexts(){this.activeTrackerHasPairsWatcher?.dispose(),this.activeTrackerHasLineOfSightWatcher?.dispose();let e=d.window.activeTextEditor,t=e?this.trackers.get(e):void 0;t?(this.activeTrackerHasPairsWatcher=t.onDidUpdateHasPairs(()=>this.inLeaperModeContext.set(t.hasPairs)),this.activeTrackerHasLineOfSightWatcher=t.onDidUpdateHasLineOfSight(()=>this.hasLineOfSightContext.set(t.hasLineOfSight)),this.inLeaperModeContext.set(t.hasPairs),this.hasLineOfSightContext.set(t.hasLineOfSight)):(this.inLeaperModeContext.set(!1),this.hasLineOfSightContext.set(!1))}dispose(){this.trackers.forEach(e=>e.dispose()),this.leapCommand.dispose(),this.escapeLeaperModeCommand.dispose(),this.inLeaperModeContext.set(!1),this.hasLineOfSightContext.set(!1),this.activeTrackerHasPairsWatcher?.dispose(),this.activeTrackerHasLineOfSightWatcher?.dispose(),this.activeTextEditorChangeWatcher.dispose(),this.visibleTextEditorsChangeWatcher.dispose(),this.selectionChangeWatcher.dispose(),this.contentChangeWatcher.dispose(),this.configurationChangeWatcher.dispose()}get mostRecentContexts(){return{inLeaperMode:this.inLeaperModeContext.mostRecent,hasLineOfSight:this.hasLineOfSightContext.mostRecent}}snapshot(){let e=new Map;for(let[{viewColumn:t},r]of this.trackers)t&&e.set(t,r.snapshot());return e}};var K;function ae(n){let e=new _;n.subscriptions.push(e),K=e}function oe(){}0&&(module.exports={activate,deactivate,testHandle});
